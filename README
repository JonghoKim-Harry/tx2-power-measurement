JETSON TX2 POWER MEASUREMENT
============


OBJECTIVE

   To measure Jetson TX2 power consumption


HOW TO BUILD and SELFTEST

    make                Build from source codes

    make check          Selftest with CIFAR-10 and MNIST dataset
                        Note that you should set variable CAFFE_HOME
                        in Makefile

    make debug          Build debug version binary and then do selftest with
                        CIFAR-10 and MNIST dataset. It will print more
                        messeages. Note that you should set variable CAFFE_HOME
                        in Makefile


HOW TO USE

    -h                  Print help message

    -c <component>      A component whose power consumption will be measured
                         * Supported components: all, cpu, gpu, ddr, wifi, soc

    -f <file name>      Path to statistics file. It will truncate content of
                        the old file and create new one


REFERENCE

   https://github.com/horizon-research/tx2-power-consumption.git
   https://devtalk.nvidia.com/default/topic/1000830/jetson-tx2/jetson-tx2-ina226-power-monitor-with-i2c-interface-/


DESIGN PRINCIPLE

   * In order to minimize measurement overhead, I used a lot of system calls.
   
   * For portability, I used only C standard-compatible or POSIX-compatible
     Linux system calls. I did NOT used any of Linux-specific system calls.
     See: Documentation/portability


CFLAGS FOR COMPILATION

   CFLAGS                   Default    Explanation

   TRACE_CPU                  ON       Trace CPU informations
   TRACE_DDR                  ON       Trace DDR/MEM informations
   TRACE_CAFFE_TIMESTAMP      OFF      Trace Caffe timestamp
   DEBUG                      OFF      Trace powertool debug
   NDEBUG                     ON       Suppress assert() defined by <assert.h>


SCRIPT USAGE EXAMPLE

   #
   sudo ./power_measurement -c gpu -i 10000 -f exp_result/cifar-10/cifar-10@10ms.txt ./script/run/run_cifar10.sh
   sudo ./power_measurement -c gpu -i 20000 -f exp_result/cifar-10/cifar-10@20ms.txt ./script/run/run_cifar10.sh
   sudo ./power_measurement -c gpu -i 30000 -f exp_result/cifar-10/cifar-10@30ms.txt ./script/run/run_cifar10.sh
   sudo ./power_measurement -c gpu -i 40000 -f exp_result/cifar-10/cifar-10@40ms.txt ./script/run/run_cifar10.sh
   sudo ./power_measurement -c gpu -i 50000 -f exp_result/cifar-10/cifar-10@50ms.txt ./script/run/run_cifar10.sh

   # Set GPU frequency to be fixed to 1122000000Hz (1.122GHz)
   sudo ./script/run/fix_gpu_freq 1122000000

   # Run experiments with all available GPU frequencies as fixed frequency
   # and default governor setup with CIFAR-10 dataset.
   sudo ./script/run/iterate_gpu_freq.sh cifar-10 ./script/run/run_cifar10.sh
   # Doing same job for MNIST dataset
   sudo ./script/run/iterate_gpu_freq.sh mnist ./script/run/run_mnist.sh

   # Run experiments with all available GPU frequencies as fixed frequency
   # and default governor setup with MNIST dataset
   sudo ./script/run/iterate_gpu_freq.sh mnist /bin/bash ./script/run/run_mnist.sh

   #
   sudo ./script/run/iterate_gpu_freq.sh caffenet-cat /bin/bash ./script/run/run_caffenet.sh /home/nvidia/caffe/examples/images/cat.jpg

   #
   sudo ./script/run/iterate_gpu_freq.sh caffenet-fishbike /bin/bash ./script/run/run_caffenet.sh /home/nvidia/caffe/examples/images/fish-bike.jpg


   # Use tegrastats to measure power, etc.
   #
   # Note that there is sleep in the script, in order to cool down CPUs or GPU
   sudo ./script/run/use_tegrastats.sh 10 cifar10-tegralog-10ms.txt script/run/run_cifar10.sh
   sudo ./script/run/use_tegrastats.sh 10 exp_result/cifar10-tegralog-10ms.txt sudo ./power_measurement -c gpu -f exp_result/cifar10-powerlog-10ms.txt ./script/run/run_cifar10.sh

   # Run CaffeNet
   ./script/run/run_caffenet.sh /home/nvidia/caffe/examples/images/cat.jpg

   # Measure CaffeNet single image inference
   ./power_measurement -c gpu -f exp_result/caffenet/caffenet-cat_power.txt /bin/bash ./script/run/run_caffenet.sh /home/nvidia/caffe/examples/images/cat.jpg

   # Draw GPU power and frequency plot
   gnuplot -c script/plot/gpu-power-frequency.plot \
              test_result/cifar-10/cifar-10_gpu_1122000000Hz.txt \
              test_result/cifar-10/cifar-10_gpu_1122000000Hz.png \
              cifar-10

   # Draw CPU and GPU power and frequency plot
   gnuplot -c script/plot/cpu-gpu-power.plot \
              test_result/mnist/mnist_gpu_1122000000Hz.txt \
              test_result/mnist/mnist_cpu_gpu_1122000000Hz.png \
              mnist

   # Draw GPU power and frequency plot for all .txt file in directory
   ./script/plot/draw_all_plot.sh test_result/cifar-10/ script/plot/gpu-power-frequency.plot gpu-power-frequency cifar-10

   # Draw CPU and GPU power and frequency plot for all .txt file in directory for CIFAR-10 dataset
   ./script/plot/draw_all_plot.sh test_result/cifar-10/ script/plot/cpu-gpu-power-frequency.plot cpu-gpu-power-frequency cifar-10

   # Draw CPU and GPU power and frequency plot for all .txt file in directory for MNIST dataset
   ./script/plot/draw_all_plot.sh test_result/mnist/ script/plot/cpu-gpu-power-frequency.plot cpu-gpu-power-frequency mnist

   # Crop caffelog files in a directory
   ./script/log/caffetime_forward.sh test_result/cifar-10/ > cifar-10.time.csv
